<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Yingjie Huang">

<title>Project 2: Regression Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="project2_files/libs/clipboard/clipboard.min.js"></script>
<script src="project2_files/libs/quarto-html/quarto.js"></script>
<script src="project2_files/libs/quarto-html/popper.min.js"></script>
<script src="project2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="project2_files/libs/quarto-html/anchor.min.js"></script>
<link href="project2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="project2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="project2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="project2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="project2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="project2_files/libs/kePrint-0.0.1/kePrint.js"></script>

<link href="project2_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Project 2: Regression Analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Yingjie Huang </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="abstract" class="level1">
<h1>Abstract</h1>
<p>Individuals with past or present major depressive disorder (MDD) face challenges in smoking cessation, with varenicline proving more effective than nicotine replacement therapy but less so for MDD patients. A recent study found that varenicline improved abstinence rates, while behavioral activation for smoking cessation (BASC) did not, regardless of its combination with varenicline. Analyzing data from a randomized 2x2 factorial design study of 300 smokers with MDD, we identified baseline predictors of abstinence, such as FTCD score, complementary reinforcers, anhedonia, BDI score, and Nicotine Metabolite Ratio. Our model showed strong predictive ability, and moderator analysis revealed that baseline FTCD moderated the effect of BASC, with greater effectiveness in participants with lower FTCD scores.</p>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Over 30% of individuals with major depressive disorder (MDD) are daily smokers and face unique challenges in smoking cessation, such as heavier smoking, greater dependence, and more severe withdrawal symptoms compared to non-MDD smokers. Despite varenicline being more effective than nicotine replacement therapy (NRT) for smoking cessation, it is often under-prescribed to individuals with mental health disorders, including MDD, due to safety concerns. Research has shown that varenicline improves abstinence in MDD patients, but additional strategies, such as Behavioral Activation for Smoking Cessation (BASC), which increases reward experience and reduces avoidance, may enhance outcomes.</p>
<p>A recent randomized, placebo-controlled trial examined the effectiveness of varenicline combined with BASC in adults with current or past MDD. The study, using a 2x2 factorial design, found that BASC did not outperform standard treatment (ST) in promoting abstinence, with or without varenicline. However, varenicline significantly improved abstinence compared to placebo. This analysis aims to investigate whether baseline variables moderate the effect of behavioral treatment (BASC vs.&nbsp;ST) on end-of-treatment (EOT) abstinence and predict EOT abstinence, controlling for pharmaceutical and behavioral treatments.</p>
<p>To achieve these goals, the study employs regularized linear models, particularly the Lasso method, to perform variable selection. The Lasso method shrinks some coefficients to zero, identifying the most relevant predictors, while balancing model accuracy and multicollinearity. The analysis will also consider more advanced techniques, like relaxed Lasso and <span class="math inline">\(L_0 + L_2\)</span> regularization, to optimize the selection of variables without increasing bias</p>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>Exploratory Data Analysis</h1>
<p>The study consists of baseline covariates, with the exception of abstinence, which is the only outcome variable. Several variables are binary, including pharmacotherapy (<code>Var</code>), psychotherapy (<code>BA</code>), and sex (<code>sex_ps</code>). Race and ethnicity are also considered binary, with indicators for non-Hispanic white (<code>NHW</code>), Black (<code>Black</code>), and Hispanic (<code>Hisp</code>). Additional binary variables include smoking behavior, specifically whether the participant smokes within five minutes of waking up (<code>ftcd.5.mins</code>), lifetime DSM-5 diagnosis (<code>otherdiag</code>), antidepressant medication use (<code>antidepmed</code>), current or past major depressive disorder (<code>mde_curr</code>), and exclusive use of menthol cigarettes (<code>Only.Menthol</code>).</p>
<p>Numeric variables in the study include age (<code>age_ps</code>), cigarettes smoked per day (<code>cpd_ps</code>), and nicotine metabolism ratio (<code>NMR</code>). Age and cigarettes per day provide information on the participant’s smoking habits, while the nicotine metabolism ratio (<code>NMR</code>) serves as a biomarker indicating how quickly nicotine is metabolized, with higher values reflecting faster metabolism.</p>
<p>In addition to these numeric and binary variables, some variables are treated as ordinal. For instance, income (<code>inc</code>) and education level (<code>edu</code>) are considered ordinal, providing a ranked scale of these demographic factors. Several other variables are treated as numeric and include measures of smoking dependence and mental health. The Fagerström Test for Cigarette Dependence score (<code>ftcd_score</code>) measures nicotine dependence, with higher scores indicating greater physical dependence on nicotine. The Beck Depression Inventory score (<code>bdi_score_pq1</code>) assesses the severity of depression, with higher scores signifying more severe symptoms of depression.</p>
<p>The study also includes variables related to the rewarding aspects of smoking. The cigarette reward value (<code>crv_total_pg1</code>) measures the participant’s preference for smoking over other rewarding activities. Reinforcer scores, including substitute (<code>hedonsum_n_pq1</code>) and complementary (<code>hedonsum_y_pq1</code>) reinforcers, are based on a Pleasant Events Schedule, assessing the frequency and enjoyment of activities associated with smoking. Anhedonia, or the inability to experience pleasure, is measured by the Snaith-Hamilton Pleasure Scale (<code>shaps_score_pg1</code>), with higher scores indicating greater enjoyment of typically rewarding experiences.</p>
<p>Lastly, readiness to quit smoking is measured by the variable readiness, which gauges the participant’s motivation and intention to stop smoking. The nicotine metabolism ratio (<code>NMR</code>) is an important biomarker in this study, as it provides insight into how quickly an individual metabolizes nicotine, which could impact their response to smoking cessation treatments.</p>
<section id="summary-of-variables" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-variables">Summary of Variables</h2>
<p>The summary statistics, generated by <a href="#tbl-summary" class="quarto-xref">Table&nbsp;1</a>, provide an overview of all variables, both overall and grouped by abstinence status. Pearson’s chi-square tests were performed to assess differences between participants with and without abstinence. Significant differences were observed for variables such as <code>Var</code>, <code>NHW</code>, <code>ftcd_score</code>, and <code>NMR</code>, which represent pharmacotherapy use, non-Hispanic white ethnicity, smoking habits upon waking, and nicotine metabolism, respectively. These findings highlight potential predictors of abstinence.</p>
<p>We observed that the discrete variables <code>edu</code> and <code>inc</code> have multiple levels, but their sample sizes are unevenly distributed across levels, with some levels having very few or excessively large observations. This imbalance could impact the stability of our model training. To address this, we combined the levels of these variables, reducing <code>edu</code> and <code>inc</code> to three levels each. Specifically, <code>inc</code> was recategorized into less than $20,000, $20,000–50,000, and more than $50,000, while <code>edu</code> was grouped into High School, Some College/Technical School, and College Graduate.</p>
<p>Additionally, we identified missing data for several variables, including Cigarette reward value, NMR, and readiness, with 18, 21, and 17 missing values, respectively. Since only 241 complete cases are available, deleting cases with missing values would risk underfitting due to the limited sample size. Therefore, we opted for multiple imputation to address the missing data, ensuring data completeness. Upon examining the missing data pattern, we determined that the data are missing completely at random (MCAR), making multiple imputation an appropriate method.</p>
<p>In the regression analysis, we treated certain ordinal variables, such as FTCD score, as continuous variables. However, because the intervals between their levels are not equidistant, this approach might introduce bias. To mitigate this, we applied polynomial fits for these variables, allowing for nonlinear relationships between their log-odds ratios and the outcome.</p>
<p>Finally, we observed an imbalanced distribution in the outcome variable <code>abst</code>, with a majority of participants (236) failing to achieve smoking cessation and only a small subset (64) successfully quitting. This imbalance could impact model training. To address this issue, we used stratified sampling during the split of training and testing datasets. This approach ensures that the distribution of <code>abst</code> remains similar across both sets, enhancing the model’s stability.</p>
<div class="cell">
<div id="tbl-summary" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Summary Table of Variables
</figcaption>
<div aria-describedby="tbl-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="tuhhabvgvr" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#tuhhabvgvr table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#tuhhabvgvr thead, #tuhhabvgvr tbody, #tuhhabvgvr tfoot, #tuhhabvgvr tr, #tuhhabvgvr td, #tuhhabvgvr th {
  border-style: none;
}

#tuhhabvgvr p {
  margin: 0;
  padding: 0;
}

#tuhhabvgvr .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#tuhhabvgvr .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#tuhhabvgvr .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#tuhhabvgvr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#tuhhabvgvr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tuhhabvgvr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tuhhabvgvr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tuhhabvgvr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#tuhhabvgvr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#tuhhabvgvr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#tuhhabvgvr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#tuhhabvgvr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#tuhhabvgvr .gt_spanner_row {
  border-bottom-style: hidden;
}

#tuhhabvgvr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#tuhhabvgvr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#tuhhabvgvr .gt_from_md > :first-child {
  margin-top: 0;
}

#tuhhabvgvr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#tuhhabvgvr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#tuhhabvgvr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#tuhhabvgvr .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#tuhhabvgvr .gt_row_group_first td {
  border-top-width: 2px;
}

#tuhhabvgvr .gt_row_group_first th {
  border-top-width: 2px;
}

#tuhhabvgvr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tuhhabvgvr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#tuhhabvgvr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#tuhhabvgvr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tuhhabvgvr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tuhhabvgvr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#tuhhabvgvr .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#tuhhabvgvr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#tuhhabvgvr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tuhhabvgvr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tuhhabvgvr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#tuhhabvgvr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tuhhabvgvr .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#tuhhabvgvr .gt_left {
  text-align: left;
}

#tuhhabvgvr .gt_center {
  text-align: center;
}

#tuhhabvgvr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#tuhhabvgvr .gt_font_normal {
  font-weight: normal;
}

#tuhhabvgvr .gt_font_bold {
  font-weight: bold;
}

#tuhhabvgvr .gt_font_italic {
  font-style: italic;
}

#tuhhabvgvr .gt_super {
  font-size: 65%;
}

#tuhhabvgvr .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#tuhhabvgvr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#tuhhabvgvr .gt_indent_1 {
  text-indent: 5px;
}

#tuhhabvgvr .gt_indent_2 {
  text-indent: 10px;
}

#tuhhabvgvr .gt_indent_3 {
  text-indent: 15px;
}

#tuhhabvgvr .gt_indent_4 {
  text-indent: 20px;
}

#tuhhabvgvr .gt_indent_5 {
  text-indent: 25px;
}

#tuhhabvgvr .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#tuhhabvgvr div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header gt_col_headings">
<th id="<div data-qmd-base64=&quot;KipDaGFyYWN0ZXJpc3RpYyoq&quot;><div class='gt_from_md'><p><strong>Characteristic</strong></p>
</div></div>" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><p><strong>Characteristic</strong></p></th>
<th id="<div data-qmd-base64=&quot;KipPdmVyYWxsKiogIApOID0gMzAw&quot;><div class='gt_from_md'><p><strong>Overall</strong><br />
N = 300</p>
</div></div><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><p><strong>Overall</strong><br>
N = 300</p>
<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span></th>
<th id="<div data-qmd-base64=&quot;KipObyoqICAKTiA9IDIzNg==&quot;><div class='gt_from_md'><p><strong>No</strong><br />
N = 236</p>
</div></div><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><p><strong>No</strong><br>
N = 236</p>
<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span></th>
<th id="<div data-qmd-base64=&quot;KipZZXMqKiAgCk4gPSA2NA==&quot;><div class='gt_from_md'><p><strong>Yes</strong><br />
N = 64</p>
</div></div><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><p><strong>Yes</strong><br>
N = 64</p>
<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span></th>
<th id="<div data-qmd-base64=&quot;KipwLXZhbHVlKio=&quot;><div class='gt_from_md'><p><strong>p-value</strong></p>
</div></div><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;><sup>2</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><p><strong>p-value</strong></p>
<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>2</sup></span></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">Pharmacotherapy</td>
<td class="gt_row gt_center" headers="stat_0"><br>
</td>
<td class="gt_row gt_center" headers="stat_1"><br>
</td>
<td class="gt_row gt_center" headers="stat_2"><br>
</td>
<td class="gt_row gt_center" headers="p.value">&lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Placebo</td>
<td class="gt_row gt_center" headers="stat_0">136/300 (45%)</td>
<td class="gt_row gt_center" headers="stat_1">124/236 (53%)</td>
<td class="gt_row gt_center" headers="stat_2">12/64 (19%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Varenicline</td>
<td class="gt_row gt_center" headers="stat_0">164/300 (55%)</td>
<td class="gt_row gt_center" headers="stat_1">112/236 (47%)</td>
<td class="gt_row gt_center" headers="stat_2">52/64 (81%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Psychotherapy</td>
<td class="gt_row gt_center" headers="stat_0"><br>
</td>
<td class="gt_row gt_center" headers="stat_1"><br>
</td>
<td class="gt_row gt_center" headers="stat_2"><br>
</td>
<td class="gt_row gt_center" headers="p.value">0.5</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;BA</td>
<td class="gt_row gt_center" headers="stat_0">151/300 (50%)</td>
<td class="gt_row gt_center" headers="stat_1">121/236 (51%)</td>
<td class="gt_row gt_center" headers="stat_2">30/64 (47%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Standard</td>
<td class="gt_row gt_center" headers="stat_0">149/300 (50%)</td>
<td class="gt_row gt_center" headers="stat_1">115/236 (49%)</td>
<td class="gt_row gt_center" headers="stat_2">34/64 (53%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Age</td>
<td class="gt_row gt_center" headers="stat_0">[19.00, 76.00]</td>
<td class="gt_row gt_center" headers="stat_1">[19.00, 76.00]</td>
<td class="gt_row gt_center" headers="stat_2">[23.00, 72.00]</td>
<td class="gt_row gt_center" headers="p.value">0.8</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Sex</td>
<td class="gt_row gt_center" headers="stat_0"><br>
</td>
<td class="gt_row gt_center" headers="stat_1"><br>
</td>
<td class="gt_row gt_center" headers="stat_2"><br>
</td>
<td class="gt_row gt_center" headers="p.value">0.8</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Female</td>
<td class="gt_row gt_center" headers="stat_0">165/300 (55%)</td>
<td class="gt_row gt_center" headers="stat_1">129/236 (55%)</td>
<td class="gt_row gt_center" headers="stat_2">36/64 (56%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Male</td>
<td class="gt_row gt_center" headers="stat_0">135/300 (45%)</td>
<td class="gt_row gt_center" headers="stat_1">107/236 (45%)</td>
<td class="gt_row gt_center" headers="stat_2">28/64 (44%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Non-Hispanic White</td>
<td class="gt_row gt_center" headers="stat_0">105/300 (35%)</td>
<td class="gt_row gt_center" headers="stat_1">74/236 (31%)</td>
<td class="gt_row gt_center" headers="stat_2">31/64 (48%)</td>
<td class="gt_row gt_center" headers="p.value">0.011</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Black</td>
<td class="gt_row gt_center" headers="stat_0">157/300 (52%)</td>
<td class="gt_row gt_center" headers="stat_1">129/236 (55%)</td>
<td class="gt_row gt_center" headers="stat_2">28/64 (44%)</td>
<td class="gt_row gt_center" headers="p.value">0.12</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Hisp</td>
<td class="gt_row gt_center" headers="stat_0">18/300 (6.0%)</td>
<td class="gt_row gt_center" headers="stat_1">15/236 (6.4%)</td>
<td class="gt_row gt_center" headers="stat_2">3/64 (4.7%)</td>
<td class="gt_row gt_center" headers="p.value">0.8</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Income</td>
<td class="gt_row gt_center" headers="stat_0"><br>
</td>
<td class="gt_row gt_center" headers="stat_1"><br>
</td>
<td class="gt_row gt_center" headers="stat_2"><br>
</td>
<td class="gt_row gt_center" headers="p.value">0.6</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;$20,000-35,000</td>
<td class="gt_row gt_center" headers="stat_0">68/297 (23%)</td>
<td class="gt_row gt_center" headers="stat_1">56/234 (24%)</td>
<td class="gt_row gt_center" headers="stat_2">12/63 (19%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;$35,001-50,000</td>
<td class="gt_row gt_center" headers="stat_0">46/297 (15%)</td>
<td class="gt_row gt_center" headers="stat_1">36/234 (15%)</td>
<td class="gt_row gt_center" headers="stat_2">10/63 (16%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;$50,001-75,000</td>
<td class="gt_row gt_center" headers="stat_0">38/297 (13%)</td>
<td class="gt_row gt_center" headers="stat_1">30/234 (13%)</td>
<td class="gt_row gt_center" headers="stat_2">8/63 (13%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Less than $20,000</td>
<td class="gt_row gt_center" headers="stat_0">110/297 (37%)</td>
<td class="gt_row gt_center" headers="stat_1">88/234 (38%)</td>
<td class="gt_row gt_center" headers="stat_2">22/63 (35%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;More than $75,000</td>
<td class="gt_row gt_center" headers="stat_0">35/297 (12%)</td>
<td class="gt_row gt_center" headers="stat_1">24/234 (10%)</td>
<td class="gt_row gt_center" headers="stat_2">11/63 (17%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_0">3</td>
<td class="gt_row gt_center" headers="stat_1">2</td>
<td class="gt_row gt_center" headers="stat_2">1</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Education</td>
<td class="gt_row gt_center" headers="stat_0"><br>
</td>
<td class="gt_row gt_center" headers="stat_1"><br>
</td>
<td class="gt_row gt_center" headers="stat_2"><br>
</td>
<td class="gt_row gt_center" headers="p.value">0.13</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;College Graduate</td>
<td class="gt_row gt_center" headers="stat_0">91/300 (30%)</td>
<td class="gt_row gt_center" headers="stat_1">66/236 (28%)</td>
<td class="gt_row gt_center" headers="stat_2">25/64 (39%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Grade School</td>
<td class="gt_row gt_center" headers="stat_0">1/300 (0.3%)</td>
<td class="gt_row gt_center" headers="stat_1">0/236 (0%)</td>
<td class="gt_row gt_center" headers="stat_2">1/64 (1.6%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;High School Graduate/GED</td>
<td class="gt_row gt_center" headers="stat_0">76/300 (25%)</td>
<td class="gt_row gt_center" headers="stat_1">60/236 (25%)</td>
<td class="gt_row gt_center" headers="stat_2">16/64 (25%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Some College/Technical School</td>
<td class="gt_row gt_center" headers="stat_0">116/300 (39%)</td>
<td class="gt_row gt_center" headers="stat_1">97/236 (41%)</td>
<td class="gt_row gt_center" headers="stat_2">19/64 (30%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Some High School</td>
<td class="gt_row gt_center" headers="stat_0">16/300 (5.3%)</td>
<td class="gt_row gt_center" headers="stat_1">13/236 (5.5%)</td>
<td class="gt_row gt_center" headers="stat_2">3/64 (4.7%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">FTCD score</td>
<td class="gt_row gt_center" headers="stat_0">5.22 (2.14)</td>
<td class="gt_row gt_center" headers="stat_1">5.46 (1.98)</td>
<td class="gt_row gt_center" headers="stat_2">4.34 (2.46)</td>
<td class="gt_row gt_center" headers="p.value">0.002</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_0">1</td>
<td class="gt_row gt_center" headers="stat_1">1</td>
<td class="gt_row gt_center" headers="stat_2">0</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Smoking with 5 mins of waking up</td>
<td class="gt_row gt_center" headers="stat_0">138/300 (46%)</td>
<td class="gt_row gt_center" headers="stat_1">113/236 (48%)</td>
<td class="gt_row gt_center" headers="stat_2">25/64 (39%)</td>
<td class="gt_row gt_center" headers="p.value">0.2</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">BDI score</td>
<td class="gt_row gt_center" headers="stat_0">18.72 (11.47)</td>
<td class="gt_row gt_center" headers="stat_1">19.14 (11.54)</td>
<td class="gt_row gt_center" headers="stat_2">17.19 (11.19)</td>
<td class="gt_row gt_center" headers="p.value">0.2</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Cigarettes per day</td>
<td class="gt_row gt_center" headers="stat_0">15.15 (7.89)</td>
<td class="gt_row gt_center" headers="stat_1">15.57 (7.81)</td>
<td class="gt_row gt_center" headers="stat_2">13.58 (8.07)</td>
<td class="gt_row gt_center" headers="p.value">0.052</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Cigarette reward value</td>
<td class="gt_row gt_center" headers="stat_0">7.19 (3.70)</td>
<td class="gt_row gt_center" headers="stat_1">7.21 (3.71)</td>
<td class="gt_row gt_center" headers="stat_2">7.09 (3.71)</td>
<td class="gt_row gt_center" headers="p.value">&gt;0.9</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_0">18</td>
<td class="gt_row gt_center" headers="stat_1">12</td>
<td class="gt_row gt_center" headers="stat_2">6</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Substitute reinforcers</td>
<td class="gt_row gt_center" headers="stat_0">22.63 (19.60)</td>
<td class="gt_row gt_center" headers="stat_1">21.90 (18.90)</td>
<td class="gt_row gt_center" headers="stat_2">25.31 (21.96)</td>
<td class="gt_row gt_center" headers="p.value">0.4</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Complementary reinforcers</td>
<td class="gt_row gt_center" headers="stat_0">25.43 (19.42)</td>
<td class="gt_row gt_center" headers="stat_1">25.97 (19.27)</td>
<td class="gt_row gt_center" headers="stat_2">23.47 (20.00)</td>
<td class="gt_row gt_center" headers="p.value">0.15</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Anhedonia</td>
<td class="gt_row gt_center" headers="stat_0">2.25 (3.16)</td>
<td class="gt_row gt_center" headers="stat_1">2.42 (3.36)</td>
<td class="gt_row gt_center" headers="stat_2">1.64 (2.22)</td>
<td class="gt_row gt_center" headers="p.value">0.3</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_0">3</td>
<td class="gt_row gt_center" headers="stat_1">3</td>
<td class="gt_row gt_center" headers="stat_2">0</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Other lifetime DSM-5 diagnosis</td>
<td class="gt_row gt_center" headers="stat_0">133/300 (44%)</td>
<td class="gt_row gt_center" headers="stat_1">109/236 (46%)</td>
<td class="gt_row gt_center" headers="stat_2">24/64 (38%)</td>
<td class="gt_row gt_center" headers="p.value">0.2</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Taking antidepressant medication</td>
<td class="gt_row gt_center" headers="stat_0">82/300 (27%)</td>
<td class="gt_row gt_center" headers="stat_1">65/236 (28%)</td>
<td class="gt_row gt_center" headers="stat_2">17/64 (27%)</td>
<td class="gt_row gt_center" headers="p.value">0.9</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Current vs past MDD</td>
<td class="gt_row gt_center" headers="stat_0"><br>
</td>
<td class="gt_row gt_center" headers="stat_1"><br>
</td>
<td class="gt_row gt_center" headers="stat_2"><br>
</td>
<td class="gt_row gt_center" headers="p.value">0.073</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Current</td>
<td class="gt_row gt_center" headers="stat_0">147/300 (49%)</td>
<td class="gt_row gt_center" headers="stat_1">122/236 (52%)</td>
<td class="gt_row gt_center" headers="stat_2">25/64 (39%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Past</td>
<td class="gt_row gt_center" headers="stat_0">153/300 (51%)</td>
<td class="gt_row gt_center" headers="stat_1">114/236 (48%)</td>
<td class="gt_row gt_center" headers="stat_2">39/64 (61%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Nicotine Metabolism Ratio</td>
<td class="gt_row gt_center" headers="stat_0">0.36 (0.23)</td>
<td class="gt_row gt_center" headers="stat_1">0.35 (0.22)</td>
<td class="gt_row gt_center" headers="stat_2">0.42 (0.26)</td>
<td class="gt_row gt_center" headers="p.value">0.023</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_0">21</td>
<td class="gt_row gt_center" headers="stat_1">15</td>
<td class="gt_row gt_center" headers="stat_2">6</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Exclusive Mentholated Cigarette User</td>
<td class="gt_row gt_center" headers="stat_0">178/298 (60%)</td>
<td class="gt_row gt_center" headers="stat_1">143/234 (61%)</td>
<td class="gt_row gt_center" headers="stat_2">35/64 (55%)</td>
<td class="gt_row gt_center" headers="p.value">0.4</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_0">2</td>
<td class="gt_row gt_center" headers="stat_1">2</td>
<td class="gt_row gt_center" headers="stat_2">0</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Readiness to quit smoking</td>
<td class="gt_row gt_center" headers="stat_0">6.78 (1.24)</td>
<td class="gt_row gt_center" headers="stat_1">6.80 (1.26)</td>
<td class="gt_row gt_center" headers="stat_2">6.68 (1.17)</td>
<td class="gt_row gt_center" headers="p.value">0.4</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_0">17</td>
<td class="gt_row gt_center" headers="stat_1">12</td>
<td class="gt_row gt_center" headers="stat_2">5</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="odd">
<td colspan="5" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span>
<p>n/N (%); [Min, Max]; Mean (SD)</p></td>
</tr>
<tr class="even">
<td colspan="5" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>2</sup></span>
<p>Pearson’s Chi-squared test; Wilcoxon rank sum test; Fisher’s exact test</p></td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="correlation-between-variables" class="level2">
<h2 class="anchored" data-anchor-id="correlation-between-variables">Correlation between Variables</h2>
<p>We then calculated the correlations between covariates, labeling those with magnitudes higher than 0.5 with their respective values, as shown in <a href="#fig-cor" class="quarto-xref">Figure&nbsp;1</a>. The resulting correlation matrix reveals that most continuous variables exhibit low to moderate correlations, indicating that multicollinearity is unlikely to pose a significant issue in our analysis. This observation suggests that each continuous variable contributes unique information, whether about participants’ physical or mental characteristics, with minimal redundancy.</p>
<p>However, we identified certain covariates with notably high correlations. For example, <code>NHW</code> and <code>Black</code> demonstrated a correlation coefficient of approximately 0.77, indicating a strong inverse relationship. This high correlation suggests that these variables may be capturing overlapping or redundant information, which could introduce multicollinearity issues in our model. Such redundancy can obscure the true relationship between other predictors and the outcome, potentially distorting model estimates.</p>
<p>To mitigate this issue, we carefully evaluated the importance and interpretability of these variables. Given their high correlation, we decided to exclude the <code>NHW</code> variable from further analysis. By removing this redundancy, we aim to enhance the robustness of our model and ensure that it accurately captures the unique contributions of the remaining covariates.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-cor" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="project2_files/figure-html/fig-cor-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Correlation between covariates
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="data-preprocessing" class="level1">
<h1>Data Preprocessing</h1>
<p>There were 241 complete cases, meaning 59 records had some degree of missing data. This reduction in sample size highlights the need for imputation to preserve the dataset’s utility. After inspecting the missing data patterns, we performed Little’s test to evaluate whether the data were missing completely at random (MCAR). The null hypothesis for this test posits that the data are not MCAR. The test yielded a p-value greater than 0.05, indicating that we could not reject the null hypothesis. Thus, we concluded that there is evidence supporting the data being MCAR.</p>
<p>To address missing data while maintaining the sample size, we impute data using the <code>mice</code> package, which employs multiple imputation to estimate missing values based on observed data. In our study, it generates five complete datasets, each with imputed values, to preserve the original sample size and enhance the reliability of our analysis. Further analysis will be conducted separately on each imputed data set and then summarized to produce a final result.</p>
</section>
<section id="model-fitting" class="level1">
<h1>Model fitting</h1>
<p>In this section, we focus on fitting a model to identify baseline variables that serve as predictors of abstinence. The analysis included all baseline covariates as potential predictors, but we limited the model to main effects only, deliberately excluding interaction terms to maintain simplicity and interpretability.</p>
<p>To account for the treatment of certain ordinal variables as continuous, we employed third-order polynomial regression. This approach allows us to capture potential nonlinear relationships between these ordinal variables and the outcome, without assuming equal spacing between levels. Each imputed dataset was analyzed independently to ensure robust results that account for variability introduced during the imputation process.</p>
<p>Given the large number of covariates in the dataset, there is a risk of overfitting, especially with a relatively small sample size. To address this, we utilized Lasso (Least Absolute Shrinkage and Selection Operator) regression for variable selection. Lasso imposes a penalty on the absolute size of the regression coefficients, effectively shrinking some coefficients to zero and excluding less important variables from the final model. This method helps to simplify the model and improve its generalizability by selecting only the most relevant predictors.</p>
<p>To evaluate model performance, we used the Area Under the Curve (AUC) of the Receiver Operating Characteristic (ROC) curve as our primary metric. For each imputed dataset, a separate model was fitted, and the AUC was calculated independently. These individual AUC values were then averaged to provide a comprehensive measure of the model’s discriminative ability across all imputations.</p>
<p>For visualizing the ROC curve, we adopted a slightly different approach. We first calculated the specificity and sensitivity for each of the five models at various thresholds. These values were then interpolated to generate a smooth curve for each model. Finally, the interpolated ROC curves were averaged to produce a single curve that represents the overall performance across different false positive rates (FPR). This ensures a clear and interpretable depiction of the model’s true positive rate (TPR) under varying conditions.</p>
<p>To ensure a more robust and stable estimation of the coefficients in our analysis, we aggregate the results obtained from the five imputed datasets. Specifically, we take the median of each coefficient across these datasets. The median is chosen as it provides a measure of central tendency that is less sensitive to extreme values or potential outliers in the imputed datasets, thereby offering a more reliable representation of the coefficients. Once the median coefficients are obtained, we transform them using exponentiation to interpret them in terms of odds ratios (OR).</p>
<section id="main-effects-of-baseline-covariates" class="level3">
<h3 class="anchored" data-anchor-id="main-effects-of-baseline-covariates">Main effects of baseline covariates</h3>
<div class="cell">
<div class="cell-output-display">
<div id="fig-roc_main" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-roc_main-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="project2_files/figure-html/fig-roc_main-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-roc_main-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Mean ROC Curves of Lasso Regression
</figcaption>
</figure>
</div>
</div>
</div>
<p>The model’s ability to discriminate between outcomes was evaluated using ROC curves. The Lasso model exhibited strong discriminative performance, achieving an AUC of 0.70 on the testing set (<a href="#fig-roc_main" class="quarto-xref">Figure&nbsp;2</a>).</p>
<p>We selected variables that were chosen at least three times across the five imputed datasets and used their median as the summarized estimate.</p>
<p>Five significant baseline predictors of abstinence were identified: <code>ftcd_score</code>, <code>Var</code>, <code>bdi_score_w00</code>, <code>hedonsum_y_pq1</code>, and <code>NMR</code> (<a href="#tbl-main" class="quarto-xref">Table&nbsp;2</a>). Treatment with varenicline showed a strong positive association with abstinence (OR = 1.78), indicating that participants receiving varenicline had nearly 1.78 times higher odds of achieving abstinence compared to those receiving placebo. This result aligns with prior literature supporting varenicline’s efficacy.</p>
<p>Additionally, nicotine metabolism rate (<code>NMR</code>) was positively associated with abstinence outcomes. Each unit increase in logNMR was linked to a 1.07 increase in the odds of achieving abstinence. The predictive value of NMR is plausible given that nicotine metabolism rate reflects how quickly individuals metabolize nicotine. Faster metabolizers often experience more intense withdrawal symptoms <span class="citation" data-cites="liakoni2019effects">[@liakoni2019effects]</span> and greater physical dependence and reward <span class="citation" data-cites="sofuoglu2012rapid">[@sofuoglu2012rapid]</span>, which can make abstinence more challenging. This finding regarding NMR diverges from some earlier studies that suggested faster metabolizers typically have greater difficulty achieving cessation. However, the relationship between nicotine metabolism and cessation outcomes is complex and may depend on the specific treatment approach. This highlights the need for further research to clarify these dynamics.</p>
<p>An odds ratio (OR) of 0.95 for the <code>ftcd_score</code> on smoking abstinence suggests that for each one-unit increase in the FTCD score, the odds of achieving smoking abstinence decrease by 5%. In other words, higher levels of nicotine dependence, as measured by the FTCD score, are associated with slightly lower likelihoods of successfully quitting smoking.</p>
<div class="cell">
<div id="tbl-main" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-main-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Summary of Main Effects
</figcaption>
<div aria-describedby="tbl-main-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Predictor</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">OR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">NMR</td>
<td style="text-align: right;">0.0654449</td>
<td style="text-align: right;">1.0676339</td>
</tr>
<tr class="even">
<td style="text-align: left;">Var</td>
<td style="text-align: right;">0.5786819</td>
<td style="text-align: right;">1.7836858</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ftcd_score</td>
<td style="text-align: right;">-0.0510155</td>
<td style="text-align: right;">0.9502639</td>
</tr>
<tr class="even">
<td style="text-align: left;">poly(NMR, 3)1</td>
<td style="text-align: right;">0.0602207</td>
<td style="text-align: right;">1.0620709</td>
</tr>
<tr class="odd">
<td style="text-align: left;">poly(bdi_score_w00, 3)3</td>
<td style="text-align: right;">0.0966681</td>
<td style="text-align: right;">1.1014947</td>
</tr>
<tr class="even">
<td style="text-align: left;">poly(ftcd_score, 3)1</td>
<td style="text-align: right;">-0.0111187</td>
<td style="text-align: right;">0.9889429</td>
</tr>
<tr class="odd">
<td style="text-align: left;">poly(ftcd_score, 3)2</td>
<td style="text-align: right;">0.5810861</td>
<td style="text-align: right;">1.7879793</td>
</tr>
<tr class="even">
<td style="text-align: left;">poly(ftcd_score, 3)3</td>
<td style="text-align: right;">-1.4339966</td>
<td style="text-align: right;">0.2383544</td>
</tr>
<tr class="odd">
<td style="text-align: left;">poly(hedonsum_y_pq1, 3)3</td>
<td style="text-align: right;">-0.0494481</td>
<td style="text-align: right;">0.9517546</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<p>Polynomial variables are challenging to interpret. Both the FTCD score (ftcd_score) and complementary reinforcer score (hedonsum_y_pq1) showed significant non-linear relationships with abstinence.</p>
<p>It shows that a cubic relationship between FTCD score and abstinence, where the highest abstinence probability occurs at low dependence levels, decreasing non-linearly as dependence increases. Similar for <code>hedonsum_y_pq1</code>. A higher <code>hedonsum_y_pq1</code> score, reflecting greater enjoyment or frequency of smoking-associated activities, likely makes quitting harder. Such participants may face more triggers to smoke and fewer non-smoking sources of reward. These findings highlight the complex, non-linear relationships between nicotine dependence, smoking-associated activities, and abstinence.</p>
</section>
<section id="moderator-effects-of-baseline-covariates" class="level3">
<h3 class="anchored" data-anchor-id="moderator-effects-of-baseline-covariates">Moderator effects of baseline covariates</h3>
<p>We investigated whether baseline variables moderate the effect of behavioral treatment (BASC vs.&nbsp;ST) on end-of-treatment (EOT) abstinence. To address this, our model included baseline covariates as main effects and also considered their interactions (and higher-order terms) with behavioral treatment to capture potential moderation effects.</p>
<p>For this analysis, we performed lasso regression with cross-validation separately on each of the five imputed datasets. Variables that were selected at least three times across the five imputed datasets were retained, and their medians were used as the summarized estimates.</p>
<p>To evaluate the model’s discriminative ability, we used the average area under the curve (AUC) as the primary metric. Additionally, the receiver operating characteristic (ROC) curve was summarized using interpolation across the datasets to visualize the model’s performance.</p>
<p>To our surprise, the Lasso model exhibited strong discriminative performance, achieving an AUC of 0.72 on the testing set while still maintaining a high AUC of 0.73 on the training set (<a href="#fig-roc_moderator" class="quarto-xref">Figure&nbsp;3</a>). This result suggests that the model effectively captures the interaction effects between baseline variables and behavioral treatment, enhancing its predictive ability. In addition to findings consistent with the previously identified main effects, our moderator analysis revealed that FTCD score significantly moderated the effect of BA treatment on abstinence outcomes (<a href="#tbl-moderator" class="quarto-xref">Table&nbsp;3</a>). Specifically, participants with lower FTCD scores showed a greater response to BASC treatment, with a higher likelihood of achieving abstinence compared to those with higher FTCD scores. This finding suggests that BASC may be more effective for individuals with lower levels of nicotine dependence, as measured by the FTCD score. The interaction between FTCD score and BASC treatment highlights the importance of considering individual differences in smoking behavior and dependence when designing smoking cessation interventions. By tailoring treatments to participants’ specific needs and characteristics, such as their level of nicotine dependence, we can optimize the effectiveness of smoking cessation programs and improve outcomes for individuals with MDD.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-roc_moderator" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-roc_moderator-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="project2_files/figure-html/fig-roc_moderator-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-roc_moderator-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Mean ROC Curves of Lasso Regression
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div id="tbl-moderator" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-moderator-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Summary of Moderator Analysis
</figcaption>
<div aria-describedby="tbl-moderator-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Predictor</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">OR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BA:poly(ftcd_score, 3)1</td>
<td style="text-align: right;">-0.0315138</td>
<td style="text-align: right;">0.9689776</td>
</tr>
<tr class="even">
<td style="text-align: left;">NMR</td>
<td style="text-align: right;">0.0115785</td>
<td style="text-align: right;">1.0116457</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Var</td>
<td style="text-align: right;">0.4162479</td>
<td style="text-align: right;">1.5162618</td>
</tr>
<tr class="even">
<td style="text-align: left;">ftcd_score</td>
<td style="text-align: right;">-0.0442767</td>
<td style="text-align: right;">0.9566892</td>
</tr>
<tr class="odd">
<td style="text-align: left;">poly(NMR, 3)1</td>
<td style="text-align: right;">0.0264628</td>
<td style="text-align: right;">1.0268160</td>
</tr>
<tr class="even">
<td style="text-align: left;">poly(cpd_ps, 3)3</td>
<td style="text-align: right;">-0.0015932</td>
<td style="text-align: right;">0.9984081</td>
</tr>
<tr class="odd">
<td style="text-align: left;">poly(ftcd_score, 3)1</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">1.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">poly(ftcd_score, 3)3</td>
<td style="text-align: right;">-0.5231170</td>
<td style="text-align: right;">0.5926703</td>
</tr>
<tr class="odd">
<td style="text-align: left;">poly(hedonsum_y_pq1, 3)3</td>
<td style="text-align: right;">-0.2567176</td>
<td style="text-align: right;">0.7735867</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
</section>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p>In this reanalysis of the BASC-Varenicline trial data, we identified several key predictors of smoking cessation success among individuals with current or past major depressive disorder (MDD). Our primary analysis confirmed varenicline’s strong positive effect on abstinence, consistent with its established efficacy. Additionally, we uncovered complex non-linear relationships between cessation success and baseline characteristics, including nicotine dependence, FTCD score, and complementary reinforcement. Notably, higher nicotine metabolism rates were associated with improved cessation outcomes. This finding diverges from some prior research, underscoring the need for further investigation into the relationship between nicotine metabolism and cessation outcomes.</p>
<p>Our moderator analysis provided particularly valuable clinical insights. We observed that the effectiveness of Behavioral Activation (BA) treatment was significantly moderated by FTCD score. Specifically, BA treatment yielded better outcomes for participants with lower levels of anhedonia, as indicated by their FTCD scores. This interaction suggests that individuals with less severe nicotine dependence may respond more favorably to behavioral interventions like BA, while those with higher dependence might require additional or alternative strategies, such as pharmacotherapy, to enhance their chances of quitting successfully.</p>
<p>Several limitations of our analysis warrant careful consideration. First, the relatively small sample size constrained our analytical approach. For instance, Hispanic ethnicity data had to be excluded due to insufficient representation (n=18), and educational and income categories were grouped to ensure model convergence. Second, the class imbalance in abstinence outcomes posed challenges for model fitting, particularly in the moderator analysis, likely contributing to reduced prediction accuracy at higher probability ranges. This imbalance also necessitated the use of multiple imputation to handle missing data, which, while essential, introduced the potential for information leakage during cross-validation.</p>
<p>Third, convergence issues stemming from the small sample size and the inclusion of numerous dichotomous variables limited our ability to employ more advanced regularization techniques. The proliferation of parameters forced us to restrict the number of terms in our model, which may have constrained the exploration of potential predictors and moderators.</p>
<p>Moving forward, incorporating expert knowledge or prior evidence into the variable screening process could help refine the model by pre-reducing the number of parameters and identifying the most promising predictors and moderators. This approach may enhance the robustness and interpretability of the findings, providing stronger guidance for personalized smoking cessation interventions.</p>
</section>
<section id="references" class="level1">
<h1>References</h1>
<div id="refs" role="list">

</div>
</section>
<section id="code-appendix" class="level1">
<h1>Code Appendix</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Select continuous variables</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"project2.csv"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Select continuous variables related to 'pq1' and other specific columns</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>con_var <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"pq1"</span>), <span class="st">"age_ps"</span>, <span class="st">"ftcd_score"</span>,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>         <span class="st">"bdi_score_w00"</span>, <span class="st">"cpd_ps"</span>, <span class="st">"NMR"</span>, <span class="st">"readiness"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()  <span class="co"># Get the column names of the selected continuous variables</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Select categorical variables by excluding 'id' and continuous variables</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>cat_var <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id, <span class="sc">-</span><span class="fu">all_of</span>(con_var)) <span class="sc">%&gt;%</span>  <span class="co"># Exclude 'id' and continuous variables (con_var)</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()  <span class="co"># Get the column names of the selected categorical variables</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Data transformation and summarization using `mutate` and `tbl_summary`</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(abst, NHW, Black, </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>                  Hisp, <span class="st">`</span><span class="at">ftcd.5.mins</span><span class="st">`</span>, Only.Menthol,</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>                  otherdiag, antidepmed), <span class="sc">~</span> <span class="fu">case_when</span>(</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">is.na</span>(.) <span class="sc">~</span> <span class="cn">NA</span>,  <span class="co"># Keep NA values as NA</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>                    . <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"No"</span>,  <span class="co"># Change 0 to "No"</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>                    . <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Yes"</span>  <span class="co"># Change 1 to "Yes"</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>                    )),</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Transform 'Var' variable from numeric to categorical</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">Var =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(Var) <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>                         Var <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Placebo"</span>,  <span class="co"># 0 -&gt; "Placebo"</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                         Var <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Varenicline"</span>),  <span class="co"># 1 -&gt; "Varenicline"</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Transform 'BA' variable from numeric to categorical</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">BA =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(BA) <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>                        BA <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Standard"</span>,  <span class="co"># 0 -&gt; "Standard"</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>                        BA <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"BA"</span>),  <span class="co"># 1 -&gt; "BA"</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Transform 'sex_ps' variable from numeric to categorical</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex_ps =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(sex_ps) <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>                            sex_ps <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Male"</span>,  <span class="co"># 1 -&gt; "Male"</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>                            sex_ps <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Female"</span>),  <span class="co"># 2 -&gt; "Female"</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Transform 'mde_curr' variable from numeric to categorical</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>         <span class="at">mde_curr =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(mde_curr) <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>                              mde_curr <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Past"</span>,  <span class="co"># 0 -&gt; "Past"</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>                              mde_curr <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Current"</span>),  <span class="co"># 1 -&gt; "Current"</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Transform 'inc' variable into income brackets</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>         <span class="at">inc =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(inc) <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>                         inc <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Less than $20,000"</span>,  <span class="co"># 1 -&gt; "Less than $20,000"</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>                         inc <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"$20,000-35,000"</span>,  <span class="co"># 2 -&gt; "$20,000-35,000"</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>                         inc <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"$35,001-50,000"</span>,  <span class="co"># 3 -&gt; "$35,001-50,000"</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>                         inc <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"$50,001-75,000"</span>,  <span class="co"># 4 -&gt; "$50,001-75,000"</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>                         inc <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"More than $75,000"</span>),  <span class="co"># 5 -&gt; "More than $75,000"</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Transform 'edu' variable into education levels</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>         <span class="at">edu =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(edu) <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>                         edu <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Grade School"</span>,  <span class="co"># 1 -&gt; "Grade School"</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>                         edu <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Some High School"</span>,  <span class="co"># 2 -&gt; "Some High School"</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>                         edu <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"High School Graduate/GED"</span>,  <span class="co"># 3 -&gt; "High School Graduate/GED"</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>                         edu <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Some College/Technical School"</span>,  <span class="co"># 4 -&gt; "Some College/Technical School"</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>                         edu <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"College Graduate"</span>)  <span class="co"># 5 -&gt; "College Graduate"</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove 'id' column before summarizing the data</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">%&gt;%</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate summary statistics using `tbl_summary`</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_summary</span>(</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"abst"</span>,  <span class="co"># Group the summary by 'abst' (abstinence) variable</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">list</span>(<span class="at">readiness=</span><span class="st">"continuous"</span>),  <span class="co"># Specify 'readiness' as continuous</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">statistic =</span> <span class="fu">list</span>(</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>      age_ps <span class="sc">~</span> <span class="st">"[{min}, {max}]"</span>,   <span class="co"># For 'age_ps', display the range (min, max)</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">all_of</span>(<span class="fu">setdiff</span>(con_var, <span class="st">"age_ps"</span>)) <span class="sc">~</span> <span class="st">"{mean} ({sd})"</span>,  <span class="co"># For other continuous variables, display mean and standard deviation</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>      <span class="fu">all_of</span>(<span class="fu">setdiff</span>(cat_var, <span class="st">"abst"</span>)) <span class="sc">~</span> <span class="st">"{n}/{N} ({p}%)"</span>  <span class="co"># For categorical variables, display counts and percentages</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">missing =</span> <span class="st">"ifany"</span>,  <span class="co"># Show missing data if any exist</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="fu">list</span>(con_var <span class="sc">~</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>)),  <span class="co"># Format continuous variables to 2 decimal places</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add custom labels for each variable in the dataset</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">list</span>(</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>      <span class="at">abst =</span> <span class="st">"Abstinence"</span>, <span class="at">Var =</span> <span class="st">"Pharmacotherapy"</span>, </span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">BA =</span> <span class="st">"Psychotherapy"</span>, <span class="at">age_ps =</span> <span class="st">"Age"</span>, <span class="at">sex_ps =</span> <span class="st">"Sex"</span>,</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>      <span class="at">NHW =</span> <span class="st">"Non-Hispanic White"</span>, <span class="at">inc =</span> <span class="st">"Income"</span>, </span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>      <span class="at">edu =</span> <span class="st">"Education"</span>, <span class="at">ftcd_score =</span> <span class="st">"FTCD score"</span>,</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>      <span class="at">ftcd.5.mins =</span> <span class="st">"Smoking with 5 mins of waking up"</span>,</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">bdi_score_w00 =</span> <span class="st">"BDI score"</span>, <span class="at">cpd_ps =</span> <span class="st">"Cigarettes per day"</span>,</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">crv_total_pq1 =</span> <span class="st">"Cigarette reward value"</span>,</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">hedonsum_n_pq1 =</span> <span class="st">"Substitute reinforcers"</span>,</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">hedonsum_y_pq1 =</span> <span class="st">"Complementary reinforcers"</span>,</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>      <span class="at">shaps_score_pq1 =</span> <span class="st">"Anhedonia"</span>,</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">otherdiag =</span> <span class="st">"Other lifetime DSM-5 diagnosis"</span>,</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>      <span class="at">antidepmed =</span> <span class="st">"Taking antidepressant medication"</span>,</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>      <span class="at">mde_curr =</span> <span class="st">"Current vs past MDD"</span>,</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>      <span class="at">NMR =</span> <span class="st">"Nicotine Metabolism Ratio"</span>,</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>      <span class="at">Only.Menthol =</span> <span class="st">"Exclusive Mentholated Cigarette User"</span>,</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>      <span class="at">readiness =</span> <span class="st">"Readiness to quit smoking"</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add overall summary statistics</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_overall</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add p-values for statistical comparisons between groups</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_p</span>()  <span class="co"># Add p-values for statistical significance</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a><span class="co"># Select continuous variables and compute the correlation matrix</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select(con_var) %&gt;%  # This line is commented out but would select the continuous variables</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(<span class="at">use=</span><span class="st">"complete.obs"</span>) <span class="sc">%&gt;%</span>  <span class="co"># Compute correlation matrix, ignoring missing values</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">melt</span>() <span class="sc">%&gt;%</span>  <span class="co"># Reshape the correlation matrix into a long format (from wide to long)</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> <span class="fu">ifelse</span>(<span class="fu">abs</span>(value) <span class="sc">&gt;</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> value <span class="sc">!=</span> <span class="dv">1</span>,  <span class="co"># Create a label for correlation values greater than 0.5 (ignores perfect correlation)</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, value), <span class="st">""</span>)) <span class="sc">%&gt;%</span>  <span class="co"># Format the correlation values to 2 decimal places</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a heatmap using ggplot</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Var1, Var2, <span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span>  <span class="co"># Create tiles for the heatmap with white borders</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">high =</span> <span class="st">"red"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, </span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>                       <span class="at">midpoint =</span> <span class="dv">0</span>, <span class="at">limit =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">space =</span> <span class="st">"Lab"</span>,  <span class="co"># Set color gradient: blue for negative, red for positive, white for 0</span></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">"Correlation"</span>) <span class="sc">+</span>  <span class="co"># Label the color scale as "Correlation"</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> text), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span>  <span class="co"># Add correlation values as text on the heatmap</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span>  <span class="co"># Use a minimal theme for the plot</span></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span>  <span class="co"># Rotate x-axis labels by 45 degrees for readability</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()  <span class="co"># Fix the aspect ratio to ensure the heatmap is square-shaped</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set random seed for reproducibility</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a><span class="co"># Impute missing values using the `mice` package and log-transform NMR</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NMR =</span> <span class="fu">log</span>(NMR),  <span class="co"># Log-transform 'NMR'</span></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>         <span class="at">inc =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(inc) <span class="sc">~</span> <span class="cn">NA</span>,  <span class="co"># Recode 'inc' variable into 3 categories</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>                         inc <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,  <span class="co"># 1 -&gt; 1</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>                         inc <span class="sc">==</span> <span class="dv">3</span> <span class="sc">|</span> inc <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">2</span>,  <span class="co"># 2 or 3 -&gt; 2</span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>                         inc <span class="sc">&gt;</span> <span class="dv">3</span> <span class="sc">~</span> <span class="dv">3</span>),  <span class="co"># values greater than 3 -&gt; 3</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>         <span class="at">edu =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(edu) <span class="sc">~</span> <span class="cn">NA</span>,  <span class="co"># Recode 'edu' variable into 3 categories</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>                         edu <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">~</span> <span class="dv">1</span>,  <span class="co"># edu &lt;= 3 -&gt; 1</span></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>                         edu <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="dv">2</span>,  <span class="co"># edu == 4 -&gt; 2</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>                         edu <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span>  <span class="co"># edu == 5 -&gt; 3</span></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id, <span class="sc">-</span>NHW, <span class="sc">-</span>Hisp) <span class="sc">%&gt;%</span>  <span class="co"># Remove 'id', 'NHW', and 'Hisp' columns</span></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mice</span>(<span class="at">m=</span><span class="dv">5</span>, <span class="at">printFlag=</span>F)  <span class="co"># Impute missing values using 5 imputed datasets</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize empty data structures to store results</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>df.roc.train <span class="ot">=</span> df.roc.test <span class="ot">=</span> <span class="fu">data.frame</span>()  <span class="co"># Empty data frames for ROC results</span></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>auc.train <span class="ot">=</span> auc.test <span class="ot">=</span> <span class="fu">c</span>()  <span class="co"># Empty vectors to store AUC for training and testing</span></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>coeff <span class="ot">=</span> <span class="fu">data.frame</span>()  <span class="co"># Empty data frame to store coefficients from each fold</span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 5-fold cross-validation</span></span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>  df.temp <span class="ot">&lt;-</span> imp <span class="sc">%&gt;%</span></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>    <span class="fu">complete</span>(<span class="at">action =</span> m)  <span class="co"># Get the m-th imputed dataset</span></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df.temp)  <span class="co"># Get the number of rows in the imputed dataset</span></span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Randomly split the data into training (80%) and test (20%) sets</span></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>  idx_train <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(df.temp<span class="sc">$</span>abst, <span class="at">p =</span> <span class="fl">0.8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)  <span class="co"># Create partition</span></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>  train <span class="ot">&lt;-</span> df.temp[idx_train, ]  <span class="co"># Training set</span></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> df.temp[<span class="sc">-</span>idx_train, ]  <span class="co"># Testing set</span></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the design matrix (X) for the training set</span></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>  fmla <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"abst ~ 0 + . +"</span>,  <span class="co"># Formula for logistic regression</span></span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">paste0</span>(<span class="st">"poly("</span>, con_var, <span class="st">", 3)"</span>, <span class="at">collapse =</span> <span class="st">" + "</span>)))  <span class="co"># Include polynomial terms for continuous variables</span></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare training data (X.train and Y.train)</span></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>  X.train <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(fmla, <span class="at">data=</span>train)  <span class="co"># Design matrix for predictors</span></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>  Y.train <span class="ot">&lt;-</span> <span class="fu">factor</span>(train<span class="sc">$</span>abst)  <span class="co"># Response variable (abstinence) as a factor</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit a lasso regression model using cross-validation (cv.glmnet)</span></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>  cv.lasso <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X.train, Y.train, <span class="at">alpha =</span> <span class="dv">1</span>,  <span class="co"># Lasso regularization (alpha=1)</span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>                        <span class="at">family=</span><span class="st">"binomial"</span>)  <span class="co"># Binomial logistic regression</span></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store the coefficients from the model for each fold</span></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>  coeff <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">coef =</span> <span class="fu">matrix</span>(<span class="fu">coef</span>(cv.lasso)),</span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>                      <span class="at">term =</span> <span class="fu">rownames</span>(<span class="fu">coef</span>(cv.lasso)),</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>                      <span class="at">fold =</span> m) <span class="sc">%&gt;%</span></span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(coeff)  <span class="co"># Combine coefficients for each fold</span></span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute ROC curve for training data</span></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>  roc.train <span class="ot">&lt;-</span> <span class="fu">roc</span>(Y.train,</span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>                   cv.lasso <span class="sc">%&gt;%</span></span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">predict</span>(X.train, <span class="at">type=</span><span class="st">"response"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>                     as.vector)  <span class="co"># Get predicted probabilities from the model</span></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a data frame for ROC results in training set</span></span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>  df.roc.train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>    <span class="at">fpr =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>),  <span class="co"># False positive rate</span></span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>    <span class="at">tpr =</span> <span class="fu">approx</span>(roc.train<span class="sc">$</span>specificities,  <span class="co"># True positive rate</span></span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>                 roc.train<span class="sc">$</span>sensitivities,</span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xout =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>),</span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>                 <span class="at">rule =</span> <span class="dv">2</span>)<span class="sc">$</span>y,  <span class="co"># Interpolate the TPR values</span></span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>    <span class="at">fold =</span> m) <span class="sc">%&gt;%</span></span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(df.roc.train)  <span class="co"># Append the ROC data for the current fold</span></span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store the AUC for the training set</span></span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>  auc.train <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">auc</span>(roc.train), auc.train)</span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare test data (X.test and Y.test)</span></span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>  X.test <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(fmla, <span class="at">data=</span>test)  <span class="co"># Design matrix for test data</span></span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>  Y.test <span class="ot">&lt;-</span> test<span class="sc">$</span>abst  <span class="co"># Response variable for test data</span></span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute ROC curve for test data</span></span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>  roc.test <span class="ot">&lt;-</span> <span class="fu">roc</span>(Y.test,</span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>                  cv.lasso <span class="sc">%&gt;%</span></span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">predict</span>(X.test, <span class="at">type=</span><span class="st">"response"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>                    as.vector)  <span class="co"># Get predicted probabilities for test data</span></span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a data frame for ROC results in testing set</span></span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>  df.roc.test <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>    <span class="at">fpr =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>),  <span class="co"># False positive rate</span></span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>    <span class="at">tpr =</span> <span class="fu">approx</span>(roc.test<span class="sc">$</span>specificities,  <span class="co"># True positive rate</span></span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>                 roc.test<span class="sc">$</span>sensitivities,</span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xout =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>),</span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ties =</span> <span class="st">"mean"</span>, <span class="at">rule =</span> <span class="dv">2</span>)<span class="sc">$</span>y,  <span class="co"># Interpolate the TPR values</span></span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>    <span class="at">fold =</span> m) <span class="sc">%&gt;%</span></span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(df.roc.test)  <span class="co"># Append the ROC data for the current fold</span></span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store the AUC for the test set</span></span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>  auc.test <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">auc</span>(roc.test), auc.test)</span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the average coefficients across all folds</span></span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>coeff <span class="ot">&lt;-</span> coeff <span class="sc">%&gt;%</span></span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(term) <span class="sc">%&gt;%</span></span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">coef =</span> <span class="fu">mean</span>(coef))  <span class="co"># Compute the mean of coefficients for each term</span></span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the training set ROC data</span></span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>df.roc.train <span class="sc">%&gt;%</span></span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fpr) <span class="sc">%&gt;%</span>  <span class="co"># Group by false positive rate (fpr)</span></span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>    <span class="at">tpr =</span> <span class="fu">mean</span>(tpr),  <span class="co"># Calculate the mean true positive rate (tpr) for each fpr</span></span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>    <span class="at">tpr_lower =</span> <span class="fu">quantile</span>(tpr, <span class="at">probs =</span> <span class="fl">0.025</span>),  <span class="co"># Compute the 2.5th percentile of tpr for confidence intervals</span></span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>    <span class="at">tpr_upper =</span> <span class="fu">quantile</span>(tpr, <span class="at">probs =</span> <span class="fl">0.975</span>)   <span class="co"># Compute the 97.5th percentile of tpr for confidence intervals</span></span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fpr, <span class="at">y =</span> tpr)) <span class="sc">+</span>  <span class="co"># Plot the mean tpr against fpr for the training set</span></span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Training"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Plot the training ROC curve in red with linewidth of 1</span></span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add testing set ROC curve by summarizing the testing data</span></span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df.roc.test <span class="sc">%&gt;%</span></span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by</span>(fpr) <span class="sc">%&gt;%</span>  <span class="co"># Group by false positive rate (fpr) for the test set</span></span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>              <span class="fu">summarise</span>(</span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>                <span class="at">tpr =</span> <span class="fu">mean</span>(tpr),  <span class="co"># Mean true positive rate for test set</span></span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>                <span class="at">tpr_lower =</span> <span class="fu">quantile</span>(tpr, <span class="at">probs =</span> <span class="fl">0.025</span>),  <span class="co"># 2.5th percentile of tpr for CI</span></span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>                <span class="at">tpr_upper =</span> <span class="fu">quantile</span>(tpr, <span class="at">probs =</span> <span class="fl">0.975</span>)   <span class="co"># 97.5th percentile of tpr for CI</span></span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>              ),</span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Testing"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Plot the testing ROC curve in blue with linewidth of 1</span></span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add labels and aesthetics to the plot</span></span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"False Positive Rate"</span>,  <span class="co"># Label for the x-axis</span></span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"True Positive Rate"</span>,   <span class="co"># Label for the y-axis</span></span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"Data set"</span>  <span class="co"># Legend title for color</span></span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span>  <span class="co"># Ensure equal scaling for both axes (aspect ratio = 1)</span></span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Customize the colors for the training and testing sets and add AUC values to the legend</span></span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Training"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Testing"</span> <span class="ot">=</span> <span class="st">"blue"</span>),</span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">sprintf</span>(<span class="st">"Testing Set (AUC = %.2f)"</span>, <span class="fu">mean</span>(auc.test)),  <span class="co"># AUC for the testing set</span></span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">sprintf</span>(<span class="st">"Training Set (AUC = %.2f)"</span>, <span class="fu">mean</span>(auc.train))  <span class="co"># AUC for the training set</span></span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>                     ))</span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter and transform the coefficients from the lasso regression model</span></span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>coeff[<span class="sc">-</span><span class="dv">1</span>, ] <span class="sc">%&gt;%</span>  <span class="co"># Exclude the first row (intercept term)</span></span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter for coefficients with absolute values greater than 0.01</span></span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(coef) <span class="sc">&gt;</span> <span class="fl">0.01</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute the Odds Ratios (OR) by exponentiating the coefficients</span></span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">OR =</span> <span class="fu">exp</span>(coef)) <span class="sc">%&gt;%</span></span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename the columns for better clarity: "term" to "Predictor" and "coef" to "Estimate"</span></span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"Predictor"</span> <span class="ot">=</span> term, <span class="st">"Estimate"</span> <span class="ot">=</span> coef) <span class="sc">%&gt;%</span></span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a table of the results using kable</span></span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Style the table with kable_styling: Centered and not full width</span></span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> F, <span class="at">position =</span> <span class="st">"center"</span>)</span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set the seed for reproducibility</span></span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize data structures for storing results</span></span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a>df.roc.train <span class="ot">=</span> df.roc.test <span class="ot">=</span> <span class="fu">data.frame</span>()  <span class="co"># Empty data frames for ROC curves</span></span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>auc.train <span class="ot">=</span> auc.test <span class="ot">=</span> <span class="fu">c</span>()  <span class="co"># Vectors to store AUC values for training and testing</span></span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a>coeff <span class="ot">=</span> <span class="fu">data.frame</span>()  <span class="co"># Data frame to store the coefficients from the lasso model</span></span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each imputation (m = 1 to 5)</span></span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Retrieve the completed dataset for the current imputation (m)</span></span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>  df.temp <span class="ot">&lt;-</span> imp <span class="sc">%&gt;%</span> <span class="fu">complete</span>(<span class="at">action =</span> m)</span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df.temp)  <span class="co"># Get the number of rows in the imputed dataset</span></span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Randomly sample 80% of the data for the training set</span></span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>  idx_train <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(df.temp<span class="sc">$</span>abst, <span class="at">p =</span> <span class="fl">0.8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>  train <span class="ot">&lt;-</span> df.temp[idx_train, ]  <span class="co"># Training data</span></span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> df.temp[<span class="sc">-</span>idx_train, ]  <span class="co"># Test data</span></span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the design matrix (X) for the training set, including interactions for 'BA' and 'Var'</span></span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>  fmla <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"abst ~ 0 + BA * (.) +"</span>, </span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">paste0</span>(<span class="st">"poly("</span>, con_var, <span class="st">", 3)"</span>, <span class="at">collapse =</span> <span class="st">" + "</span>),  <span class="co"># Add cubic terms for continuous variables</span></span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"+ BA * ("</span>, <span class="fu">paste0</span>(<span class="st">"poly("</span>, con_var, <span class="st">", 3)"</span>, <span class="at">collapse =</span> <span class="st">" + "</span>), <span class="st">")"</span>))  <span class="co"># Interaction terms</span></span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>  X.train <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(fmla, <span class="at">data =</span> train)  <span class="co"># Create the design matrix for training</span></span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a>  Y.train <span class="ot">&lt;-</span> <span class="fu">factor</span>(train<span class="sc">$</span>abst)  <span class="co"># Outcome variable as a factor</span></span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit a lasso regression model (cv.glmnet performs cross-validation for alpha = 1, lasso)</span></span>
<span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a>  cv.lasso <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X.train, Y.train, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store the coefficients for each fold</span></span>
<span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a>  coeff <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">coef =</span> <span class="fu">matrix</span>(<span class="fu">coef</span>(cv.lasso)), <span class="at">term =</span> <span class="fu">rownames</span>(<span class="fu">coef</span>(cv.lasso)), <span class="at">fold =</span> m) <span class="sc">%&gt;%</span></span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(coeff)</span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the ROC curve for the training set</span></span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a>  roc.train <span class="ot">&lt;-</span> <span class="fu">roc</span>(Y.train, cv.lasso <span class="sc">%&gt;%</span> <span class="fu">predict</span>(X.train, <span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">%&gt;%</span> as.vector)</span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store the ROC curve data for plotting (true positive rate vs false positive rate)</span></span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a>  df.roc.train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a>    <span class="at">fpr =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>),  <span class="co"># False positive rate (FPR) sequence from 0 to 1</span></span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>    <span class="at">tpr =</span> <span class="fu">approx</span>(roc.train<span class="sc">$</span>specificities, </span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a>                 roc.train<span class="sc">$</span>sensitivities, </span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xout =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>), </span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a>                 <span class="at">rule =</span> <span class="dv">2</span>)<span class="sc">$</span>y,  <span class="co"># Interpolate true positive rate (TPR) for FPR</span></span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a>    <span class="at">fold =</span> m</span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(df.roc.train)</span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store the AUC for the training set</span></span>
<span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a>  auc.train <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">auc</span>(roc.train), auc.train)</span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the design matrix for the test set and predict probabilities</span></span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a>  X.test <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(fmla, <span class="at">data =</span> test)</span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a>  Y.test <span class="ot">&lt;-</span> test<span class="sc">$</span>abst</span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a>  roc.test <span class="ot">&lt;-</span> <span class="fu">roc</span>(Y.test, cv.lasso <span class="sc">%&gt;%</span> <span class="fu">predict</span>(X.test, <span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">%&gt;%</span> as.vector)</span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store the ROC curve data for the test set</span></span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a>  df.roc.test <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a>    <span class="at">fpr =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>),</span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a>    <span class="at">tpr =</span> <span class="fu">approx</span>(roc.test<span class="sc">$</span>specificities, </span>
<span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a>                 roc.test<span class="sc">$</span>sensitivities, </span>
<span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xout =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>), </span>
<span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ties =</span> <span class="st">"mean"</span>, <span class="at">rule =</span> <span class="dv">2</span>)<span class="sc">$</span>y, </span>
<span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a>    <span class="at">fold =</span> m</span>
<span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(df.roc.test)</span>
<span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store the AUC for the test set</span></span>
<span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a>  auc.test <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">auc</span>(roc.test), auc.test)</span>
<span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-336"><a href="#cb1-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-337"><a href="#cb1-337" aria-hidden="true" tabindex="-1"></a><span class="co"># Average the coefficients across all folds</span></span>
<span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a>coeff <span class="ot">&lt;-</span> coeff <span class="sc">%&gt;%</span></span>
<span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(term) <span class="sc">%&gt;%</span></span>
<span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">coef =</span> <span class="fu">mean</span>(coef))  <span class="co"># Compute the mean coefficient across folds</span></span>
<span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the mean, lower (2.5th percentile), and upper (97.5th percentile) of TPR for each FPR value in the training set</span></span>
<span id="cb1-343"><a href="#cb1-343" aria-hidden="true" tabindex="-1"></a>df.roc.train <span class="sc">%&gt;%</span></span>
<span id="cb1-344"><a href="#cb1-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fpr) <span class="sc">%&gt;%</span></span>
<span id="cb1-345"><a href="#cb1-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb1-346"><a href="#cb1-346" aria-hidden="true" tabindex="-1"></a>    <span class="at">tpr =</span> <span class="fu">mean</span>(tpr),  <span class="co"># Mean true positive rate</span></span>
<span id="cb1-347"><a href="#cb1-347" aria-hidden="true" tabindex="-1"></a>    <span class="at">tpr_lower =</span> <span class="fu">quantile</span>(tpr, <span class="at">probs =</span> <span class="fl">0.025</span>),  <span class="co"># 2.5th percentile for TPR</span></span>
<span id="cb1-348"><a href="#cb1-348" aria-hidden="true" tabindex="-1"></a>    <span class="at">tpr_upper =</span> <span class="fu">quantile</span>(tpr, <span class="at">probs =</span> <span class="fl">0.975</span>)   <span class="co"># 97.5th percentile for TPR</span></span>
<span id="cb1-349"><a href="#cb1-349" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-350"><a href="#cb1-350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fpr, <span class="at">y =</span> tpr)) <span class="sc">+</span>  <span class="co"># Plot FPR vs mean TPR</span></span>
<span id="cb1-351"><a href="#cb1-351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Training"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Plot training data ROC curve with red color</span></span>
<span id="cb1-352"><a href="#cb1-352" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute and plot the mean ROC curve for the testing set</span></span>
<span id="cb1-353"><a href="#cb1-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb1-354"><a href="#cb1-354" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df.roc.test <span class="sc">%&gt;%</span></span>
<span id="cb1-355"><a href="#cb1-355" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(fpr) <span class="sc">%&gt;%</span></span>
<span id="cb1-356"><a href="#cb1-356" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb1-357"><a href="#cb1-357" aria-hidden="true" tabindex="-1"></a>        <span class="at">tpr =</span> <span class="fu">mean</span>(tpr),  <span class="co"># Mean true positive rate for testing</span></span>
<span id="cb1-358"><a href="#cb1-358" aria-hidden="true" tabindex="-1"></a>        <span class="at">tpr_lower =</span> <span class="fu">quantile</span>(tpr, <span class="at">probs =</span> <span class="fl">0.025</span>),  <span class="co"># 2.5th percentile for TPR</span></span>
<span id="cb1-359"><a href="#cb1-359" aria-hidden="true" tabindex="-1"></a>        <span class="at">tpr_upper =</span> <span class="fu">quantile</span>(tpr, <span class="at">probs =</span> <span class="fl">0.975</span>)   <span class="co"># 97.5th percentile for TPR</span></span>
<span id="cb1-360"><a href="#cb1-360" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb1-361"><a href="#cb1-361" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Testing"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>  <span class="co"># Plot testing data ROC curve with blue color</span></span>
<span id="cb1-362"><a href="#cb1-362" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1-363"><a href="#cb1-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1-364"><a href="#cb1-364" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Mean ROC Curves of Lasso Regression"</span>,  <span class="co"># Add title</span></span>
<span id="cb1-365"><a href="#cb1-365" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"False Positive Rate"</span>,  <span class="co"># Label for the x-axis</span></span>
<span id="cb1-366"><a href="#cb1-366" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"True Positive Rate"</span>,   <span class="co"># Label for the y-axis</span></span>
<span id="cb1-367"><a href="#cb1-367" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"Data set"</span>            <span class="co"># Legend label for the data set</span></span>
<span id="cb1-368"><a href="#cb1-368" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1-369"><a href="#cb1-369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span>  <span class="co"># Fix the aspect ratio to make sure the plot is square</span></span>
<span id="cb1-370"><a href="#cb1-370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb1-371"><a href="#cb1-371" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Training"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Testing"</span> <span class="ot">=</span> <span class="st">"blue"</span>),  <span class="co"># Set colors for training and testing</span></span>
<span id="cb1-372"><a href="#cb1-372" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb1-373"><a href="#cb1-373" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sprintf</span>(<span class="st">"Testing Set (AUC = %.2f)"</span>, <span class="fu">mean</span>(auc.test)),  <span class="co"># Label for the testing set with its AUC</span></span>
<span id="cb1-374"><a href="#cb1-374" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sprintf</span>(<span class="st">"Training Set (AUC = %.2f)"</span>, <span class="fu">mean</span>(auc.train))  <span class="co"># Label for the training set with its AUC</span></span>
<span id="cb1-375"><a href="#cb1-375" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-376"><a href="#cb1-376" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-377"><a href="#cb1-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-378"><a href="#cb1-378" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the intercept (first row) and filter out coefficients that are equal to 0</span></span>
<span id="cb1-379"><a href="#cb1-379" aria-hidden="true" tabindex="-1"></a>coeff[<span class="sc">-</span><span class="dv">1</span>, ] <span class="sc">%&gt;%</span></span>
<span id="cb1-380"><a href="#cb1-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(coef <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span>  <span class="co"># Keep only non-zero coefficients</span></span>
<span id="cb1-381"><a href="#cb1-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">OR =</span> <span class="fu">exp</span>(coef)) <span class="sc">%&gt;%</span>  <span class="co"># Calculate the Odds Ratio (OR) by exponentiating the coefficient</span></span>
<span id="cb1-382"><a href="#cb1-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"Predictor"</span> <span class="ot">=</span> term, <span class="st">"Estimate"</span> <span class="ot">=</span> coef) <span class="sc">%&gt;%</span>  <span class="co"># Rename columns for better readability</span></span>
<span id="cb1-383"><a href="#cb1-383" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span>  <span class="co"># Create a nicely formatted table using 'kable'</span></span>
<span id="cb1-384"><a href="#cb1-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position=</span><span class="st">"center"</span>)  <span class="co"># Style the table: make it not full width and center it</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>